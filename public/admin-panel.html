<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>AgroDigital 5.0™ | Global Secure Panel</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="theme-color" content="#002233">
  <link rel="manifest" href="manifest.json">
  <link rel="apple-touch-icon" href="assets/icon-192.png">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flag-icons/css/flag-icons.min.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/i18next@21.6.3/i18next.min.js"></script>
  <style>
    body { background: #002233 url('https://i.imgur.com/sPUr8I6.png') no-repeat center center fixed; background-size: cover; color: white;}
    .header-text { text-align: center; margin: 35px 0 30px 0; }
    .panel-box { display: none; margin-top: 30px;}
    .active-panel { display: block; }
    .nav-pills .nav-link.active { background:#00a86b !important; }
    .nav-pills .nav-link { color:#002233; font-weight:600; }
    .kpi-box { display: flex; gap: 20px; margin: 35px 0 20px 0; flex-wrap: wrap; justify-content: center;}
    .kpi-card { background: #011826b8; border-radius: 8px; padding: 16px 32px; text-align: center; box-shadow: 0 4px 18px 2px #003f2e50; min-width: 160px;}
    .kpi-title { color: #00a86b; font-size: 15px; }
    .kpi-value { font-size: 2.2rem; font-weight: bold;}
    .faceid-btn { background: #002233; border: none; color: #00e676; font-size: 1.6rem; border-radius: 100px; padding: 6px 18px; }
    #faceid-info { color:#90ffb1; margin-top:8px; }
    @media(max-width:600px){ .kpi-box{flex-direction:column; align-items:center;} }
  </style>
</head>
<body>

<div class="header-text">
  <h1>AgroDigital 5.0™</h1>
  <p>Connecting agriculture to the global digital economy</p>
  <div class="lang-switch mb-2">
    <button onclick="switchLang('en')"><span class="fi fi-us"></span></button>
    <button onclick="switchLang('pt')"><span class="fi fi-br"></span></button>
    <button onclick="switchLang('es')"><span class="fi fi-es"></span></button>
  </div>
</div>

<!-- LOGIN / BIOMETRIA -->
<div class="container" id="loginBox" style="max-width:370px;">
  <h4 class="text-center mb-3" id="loginTitle">Login Access</h4>
  <input type="text" id="loginUser" class="form-control mb-2" placeholder="User (ex: admin1)" autocomplete="username">
  <input type="password" id="loginPass" class="form-control mb-2" placeholder="Password" autocomplete="current-password">
  <button class="btn btn-success w-100 mb-2" onclick="doLogin()" id="loginBtn">Enter</button>
  <button class="faceid-btn w-100" onclick="doFaceID()" id="faceidBtn">🔒 Face ID / Touch ID</button>
  <div id="faceid-info" class="text-center"></div>
</div>

<!-- ÁREAS INTERNAS -->
<div class="container">
  <ul class="nav nav-pills justify-content-center" id="mainTabs" style="margin-top:32px;display:none;">
    <li class="nav-item"><a class="nav-link active" onclick="showPanel('client')">Client Dashboard</a></li>
    <li class="nav-item"><a class="nav-link" onclick="showPanel('presale')">Token Pre-Sale</a></li>
    <li class="nav-item admin-tab"><a class="nav-link" onclick="showPanel('admindash')">Admin Dashboard</a></li>
    <li class="nav-item admin-tab"><a class="nav-link" onclick="showPanel('vaults')">Vaults</a></li>
    <li class="nav-item admin-tab"><a class="nav-link" onclick="showPanel('settings')">Settings</a></li>
  </ul>
  <!-- Client Dashboard -->
  <div class="panel-box active-panel" id="panel-client">
    <div class="kpi-box">
      <div class="kpi-card"><div class="kpi-title" id="kpi-tokens-title">Tokens Sold</div><div class="kpi-value" id="kpi-tokens">12,300</div></div>
      <div class="kpi-card"><div class="kpi-title" id="kpi-revenue-title">Total Revenue</div><div class="kpi-value" id="kpi-revenue">$287,000</div></div>
    </div>
    <canvas id="cryptoChart"></canvas>
    <p class="text-center mt-3" id="unitsLabel">Units Sold: <span id="unitsSold">0</span></p>
  </div>
  <!-- Token Pre-sale (Cliente e Admin) -->
  <div class="panel-box" id="panel-presale">
    <h3>Token Pre-Sale</h3>
    <button class="btn btn-primary" onclick="connectWallet()" id="walletBtn">Connect Wallet</button>
    <button class="btn btn-info" onclick="buyToken()" id="buyTokenBtn">Buy Token Now</button>
    <button class="btn btn-warning" onclick="window.open('https://bscscan.com/', '_blank')" id="bscscanBtn">Check Contract (BscScan)</button>
  </div>
  <!-- Admin Dashboard -->
  <div class="panel-box" id="panel-admindash">
    <h3>Admin Panel</h3>
    <div class="kpi-box">
      <div class="kpi-card"><div class="kpi-title">Active Investors</div><div class="kpi-value">184</div></div>
      <div class="kpi-card"><div class="kpi-title">Leads Generated</div><div class="kpi-value">965</div></div>
    </div>
    <p>Advanced analytics, pre-sale control, multi-vaults, BI & more.</p>
  </div>
  <!-- Vaults -->
  <div class="panel-box" id="panel-vaults">
    <h3>Vault Management</h3>
    <button class="btn btn-success" onclick="listarVaults()">List Vaults</button>
    <table class="table table-dark table-sm mt-2">
      <thead><tr><th>Vault</th><th>Balance</th><th>Actions</th></tr></thead>
      <tbody id="vaultsTable"></tbody>
    </table>
  </div>
  <!-- Settings -->
  <div class="panel-box" id="panel-settings">
    <h3>Settings</h3>
    <button class="btn btn-outline-secondary" onclick="changeTheme()">Change Theme</button>
    <p>App installed as PWA? <span id="pwaStatus"></span></p>
  </div>
</div>

<!-- Instalar como App (PWA) -->
<div class="container text-center my-3" id="installAppPrompt" style="display:none;">
  <button class="btn btn-success" id="btnInstallApp"><i class="bi bi-cloud-arrow-down"></i> Install AgroDigital App</button>
</div>

<script>
  // Multiusuário: admin1 e admin2
  const admins = [
    {user: "admin1", pass: "Agro@2025!"},
    {user: "admin2", pass: "Board$2025"}
  ];
  let loggedUser = null;
  let isAdmin = false;

  // Internacionalização (expandir conforme sua estratégia)
  const langResources = {
    en: {translation: {"Tokens Sold":"Tokens Sold","Total Revenue":"Total Revenue","Login Access":"Login Access","Enter":"Enter"}},
    pt: {translation: {"Tokens Sold":"Tokens Vendidos","Total Revenue":"Receita Total","Login Access":"Acesso Login","Enter":"Entrar"}}
  };
  i18next.init({ lng: 'en', resources: langResources }, updateLang);
  function switchLang(lang){i18next.changeLanguage(lang,updateLang);}
  function updateLang(){document.getElementById("kpi-tokens-title").innerText=i18next.t('Tokens Sold');document.getElementById("kpi-revenue-title").innerText=i18next.t('Total Revenue');document.getElementById("loginTitle").innerText=i18next.t('Login Access');document.getElementById("loginBtn").innerText=i18next.t('Enter');}

  // Login/Senha/Admin/FaceID
  function doLogin(){
    const u = document.getElementById('loginUser').value.trim();
    const p = document.getElementById('loginPass').value;
    const adminObj = admins.find(a=>a.user===u&&a.pass===p);
    if(adminObj){
      loggedUser = u;
      isAdmin = true;
      loginSuccess();
    }else if(u && p){
      loggedUser = u;
      isAdmin = false;
      loginSuccess();
    }else{
      alert("Invalid login or password.");
    }
  }
  function doFaceID(){
    if (!window.PublicKeyCredential) {
      document.getElementById('faceid-info').innerText = "Seu dispositivo/navegador não suporta biometria.";
      return;
    }
    navigator.credentials.get({publicKey:{challenge:new Uint8Array(26),timeout:60000,userVerification:"required"}}).then(()=>{
      loggedUser = "admin1";
      isAdmin = true;
      loginSuccess();
    }).catch(()=>{document.getElementById('faceid-info').innerText="Face ID/Touch ID cancelado ou não autorizado.";});
  }
  function loginSuccess(){
    document.getElementById('loginBox').style.display = 'none';
    document.getElementById('mainTabs').style.display = '';
    // Exibe abas admin só para admins
    document.querySelectorAll('.admin-tab').forEach(tab=>tab.style.display=isAdmin?'':'none');
    showPanel(isAdmin?'admindash':'client');
    // Se App, mostra info
    document.getElementById('pwaStatus').innerText = window.matchMedia('(display-mode: standalone)').matches ? "✅ Sim" : "⛔️ Não";
  }
  function showPanel(panel){
    document.querySelectorAll('.panel-box').forEach(box=>box.classList.remove('active-panel'));
    document.getElementById('panel-'+panel).classList.add('active-panel');
    // Instalação como App: Mostra info/prompt
    if(panel==='settings')document.getElementById('installAppPrompt').style.display='';
    else document.getElementById('installAppPrompt').style.display='none';
  }
  // Chart.js: KPIs & vendas
  let units=0;
  document.addEventListener("DOMContentLoaded",()=>{
    new Chart(document.getElementById('cryptoChart').getContext('2d'),{
      type:'line',
      data:{labels:['CornToken','BNB','ETH','BTC'],datasets:[{label:'Crypto Prices',data:[15.3,5,3,9],borderColor:'lime',borderWidth:2,fill:true}]},
      options:{responsive:true}
    });
    // PWA (App install prompt)
    let deferredPrompt;
    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      deferredPrompt = e;
      document.getElementById('installAppPrompt').style.display = '';
      document.getElementById('btnInstallApp').onclick = function() {
        deferredPrompt.prompt();
      };
    });
  });
  // Web3/Wallet/Token compra
  function connectWallet(){
    if(window.ethereum){window.ethereum.request({method:'eth_requestAccounts'});}
    else{alert("Please install MetaMask to continue!");}
  }
  function buyToken(){
    units++;document.getElementById('unitsSold').innerText=units;alert("Token comprado com sucesso!");
  }
  // Vaults (exemplo)
  function listarVaults(){
    const vaults=[{name:"Liquidity Vault",balance:"$100,000"},{name:"Founder Vault",balance:"$250,000"}];
    let tbody=document.getElementById("vaultsTable");
    tbody.innerHTML="";
    vaults.forEach(v=>{tbody.innerHTML+=`<tr><td>${v.name}</td><td>${v.balance}</td><td><button class="btn btn-outline-light btn-sm" onclick="alert('Retirada solicitada de: ${v.name}')">Retirar</button></td></tr>`;});
  }
  function changeTheme(){alert('Tema dinâmico disponível na próxima versão.');}
</script>
<script>
  // Ativa PWA
  if ('serviceWorker' in navigator) { navigator.serviceWorker.register('sw.js'); }
</script>
</body>
</html>
